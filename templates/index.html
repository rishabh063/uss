<!DOCTYPE html>
<html>
<head>
    <title>Upload File</title>
</head>
<body>
    <h1>Upload File</h1>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload') }}">
        <label for="faceImage">Face Image:</label>
        <input type="file" name="file" id="faceImageInput">
        <br><br>
        <label for="emailID">Email ID:</label>
        <input type="text" id="emailID" name="emailID">
        <br><br>
        <label for="fileUpload">File Upload:</label>
        <input type="file" name="file" id="fileInput">
        <script>
            const faceImageInput = document.getElementById('faceImageInput');
            const fileInput = document.getElementById('fileInput');
            const emailIDInput = document.getElementById('emailID');
            const submitButton = document.querySelector('input[type="submit"]');
            submitButton.addEventListener('click', (event) => {
                event.preventDefault();
                const faceImageFile = faceImageInput.files[0];
                const file = fileInput.files[0];
                const emailID = emailIDInput.value;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const faceImageContent = event.target.result.split(',')[1];
                    const fileContent = event.target.result.split(',')[1];
                    const contentType = faceImageFile.type;
                    const data = {
                        faceImage: faceImageContent,
                        emailID: emailID,
                        file: fileContent,
                        contentType: contentType
                    };
                    fetch('{{ url_for("upload") }}', {
                        method: 'POST',
                        body: JSON.stringify(data)
                    }).then(response => {
                        console.log('Response:', response);
                        // Do something with the response
                    }).catch(error => {
                        console.error('Error:', error);
                    });
                };
                reader.readAsDataURL(faceImageFile);
                reader.readAsDataURL(file);
            });
        </script>
        <br><br>
        <input type="submit" value="Upload">
    </form>


    <h1>Get File</h1>
    <button onclick="toggleCamera()">Toggle Camera</button>

    <form method="POST" enctype="multipart/form-data" action="{{ url_for('collect') }}">
        <label for="faceImage">Video</label>
        <input type="file" name="file">
        <br><br>
        <label for="emailID">emailID:</label>
        <input type="text" id="emailID" name="emailID">
        <input type="submit" value="collect">
    </form>

    <br><br>
    <div id="videoContainer">
        <video autoplay="true" id="videoElement"></video>
    </div>
    <br><br>

    <script>
        var video = document.querySelector("#videoElement");
        var videoContainer = document.querySelector("#videoContainer");
        var stream = null;
    
        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (cameraStream) {
                    video.srcObject = cameraStream;
                    stream = cameraStream;
                })
                .catch(function (err) {
                    console.log("Something went wrong!", err);
                });
        }
    
        function toggleCamera() {
            if (stream) {
                // Stop camera
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.pause();
                videoContainer.style.display = "hidden";
            } else {
                // Start camera
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function (cameraStream) {
                        video.srcObject = cameraStream;
                        stream = cameraStream;
                        video.play();
                        videoContainer.style.display = "block";
                    })
                    .catch(function (err) {
                        console.log("Something went wrong!", err);
                    });
            }
        }
    </script>
</body>
</html>
